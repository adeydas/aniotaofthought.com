---
title: "Continuous Deployment of Blog Posts"
date: 2018-03-09T22:16:16-08:00
draft: false
tags: [aws, hugo, s3, cloudfront, route53]
layout: "post"
---

In my [first](https://aniotaofthought.com/posts/static-website-with-hugo-s3-cloudfront-and-route53/) and [second](https://aniotaofthought.com/posts/invalidating-cache-static-website-s3-cloudfront/) posts on this topic I talked about setting up my static blog. This post is about deploying changes in a continuous fashion. I mean, let's face it, one of the not so nice things about having static blogs is the lack of ability to create and edit content from any computer. There are several ways to continuously deploy changes but as always, I chose the most frugal path: a simple wercker build script.

# Desktop to the cloud
I chose Github as my choice of remote storage for raw content. With that and S3 and CloudFront, my overall sequence flow of deplyoments look something like this:

![Overall Sequence Flow](/images/blog_cd.png)

I have covered things outside the big box on the left in previous posts, so I will touch the components inside the box. Github and git is fairly common and there is nothing special with my setup. Here's my [github repository](https://github.com/adeydas/aniotaofthought.com) if you are interested in taking a quick peek. I will jump right in to the wercker build file.

## Set Wercker up
Wercker builds are based on YAML based config files. This is how my config look:

<script src="https://gist.github.com/adeydas/6e82468c8a617bfaa0172a518e51ab37.js"></script>

There are two broad concepts with Wercker: pipelines and steps. As you have probably guessed, a pipeline is a deployment target and it consists of one or more steps, each tasked to do some atomic task. In my case, I have two pipelines, one dependent on the other: a build pipeline to build my static site and a deploy pipeline to deploy the artifacts to S3.

### The Build pipeline
My build pipeline consists of only one step: *arjen/hugo-build*. Wercker enables pipeline to consume steps created by other developers and shared via their marketplace. This particular step simply accepts a bunch of arguments, the files from my git repository, compiles them and stores the generated artifacts.

### The Deploy pipeline
My deploy pipeline consists of two steps: a *pip-install* step to install the *certifi* library for the root certificates required by the next step and *s3sync* step to sync the stored artifacts generated by the previous pipeline with my S3 bucket. Both *pip-install* and *s3sync* are available in the Wercker marketplace.

And that's all I need to continuously deploy my static site. If you are curious about how my builds look, [here they are](https://app.wercker.com/adeydas/aniotaofthought.com/runs).